# 3D模型生成平台架构设计文档

## 项目分工
### 后端开发：魏荣
- 负责调研3D模型生成API
- 后端架构设计
- 数据库表设计
- 接口设计
- 编写文档
- 开发功能模块（任务管理模块以及文件存储模块）

### 前端开发：庄梓坚
- 负责前端架构设计
- Vue 3 + Three.js 技术栈选型
- 3D模型渲染和交互功能
- 用户界面设计和实现
- 前端状态管理和路由配置
- 前端构建和部署优化

## 项目概述

### 项目名称
3D Model Generation Platform (基于Tripo AI的3D模型生成平台)

### 项目描述
一个基于Java Spring Boot的3D模型生成平台，集成Tripo AI API，支持文本和图片生成3D模型，提供完整的文件存储、任务管理和前端展示功能。

### 技术栈
- **后端**: Java 17, Spring Boot 3.2.0, MyBatis Plus
- **数据库**: MySQL 8.0
- **文件存储**: 阿里云OSS
- **3D生成**: Tripo AI API
- **前端**: Vue 3 (Composition API), Three.js 0.180.0, Element Plus 2.11.3
- **前端构建**: Vite 7.0.6
- **状态管理**: Pinia 3.0.3
- **路由管理**: Vue Router 4.5.1
- **HTTP客户端**: Axios 1.12.2
- **后端构建工具**: Maven

## 系统架构

### 整体架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用       │    │   后端服务       │    │   外部服务       │
│  (Vue + Three)  │◄──►│ (Spring Boot)   │◄──►│   Tripo AI      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │                         │
                              ▼                         ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │   MySQL数据库    │    │   阿里云OSS      │
                       └─────────────────┘    └─────────────────┘
```

### 后端分层架构
```
┌─────────────────────────────────────────────────────────────┐
│                    表现层 (Presentation Layer)               │
│  ┌─────────────┐                   ┌─────────────┐          │
│  │ Controller  │                   │ Upload      │          │
│  └─────────────┘                   └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│                    业务层 (Business Layer)                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │ TripoService│  │ OssService  │  │FileTransfer │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│                    数据层 (Data Layer)                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │   Mapper    │  │   Entity    │  │    DTO      │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

## 核心模块设计

### 1. 任务管理模块 (Task Management)

#### 功能职责
- 3D模型生成任务的创建、跟踪和管理
- 支持文本生成3D和图片生成3D两种模式
- 异步任务处理和状态轮询

#### 核心类
- **ModelTask.java**: 任务实体，包含任务基本信息、输入数据、输出结果、状态管理
- **TripoService.java**: 任务服务，提供文本/图片生成3D、任务完成等待、文件转存功能

#### 状态流转
```
PENDING → RUNNING → TRANSFERRING → SUCCESS
    ↓         ↓           ↓
  FAILED ← FAILED ← FAILED
```

### 2. 文件存储模块 (File Storage)

#### 功能职责
- 阿里云OSS文件上传和管理
- Tripo临时文件到永久存储的转存
- 文件访问代理（解决跨域问题）

#### 文件组织结构
```
seven-mulik/
├── model3d/
│   ├── upload/images/        # 用户上传图片
│   ├── model/               # 3D模型文件(.glb)
│   ├── pbr_model/           # PBR模型文件
│   ├── preview/             # 预览图片
│   ├── texture/             # 纹理贴图
│   ├── normal_map/          # 法线贴图
│   ├── metallic_map/        # 金属度贴图
│   └── roughness_map/       # 粗糙度贴图
```

## 前端架构设计

### 前端项目结构
```
web/
├── public/                     # 静态资源
│   ├── favicon.ico
│   └── models/                 # 3D模型文件
│       └── gltf/
├── src/                        # 源代码
│   ├── api/                    # API 接口层
│   ├── assets/                 # 静态资源
│   ├── components/             # 组件
│   ├── config/                 # 配置文件
│   ├── router/                 # 路由配置
│   ├── stores/                 # 状态管理
│   ├── utils/                  # 工具函数
│   ├── App.vue                 # 根组件
│   └── main.js                 # 入口文件
├── .env.development            # 开发环境配置
├── .env.production             # 生产环境配置
├── package.json                # 项目依赖
├── vite.config.js              # Vite 配置
└── README.md                   # 项目说明
```

### 前端分层架构
```
┌─────────────────────────────────────────────────────────────┐
│                        用户界面层                            │
├─────────────────────────────────────────────────────────────┤
│  AppHeader  │  LeftNav  │  CenterWorkspace  │  RightColumn  │
├─────────────────────────────────────────────────────────────┤
│                        业务逻辑层                            │
├─────────────────────────────────────────────────────────────┤
│    状态管理(Pinia)    │    路由管理(Vue Router)             │
├─────────────────────────────────────────────────────────────┤
│                        数据访问层                            │
├─────────────────────────────────────────────────────────────┤
│      API接口层(Axios)     │     本地存储(LocalStorage)      │
├─────────────────────────────────────────────────────────────┤
│                        基础设施层                            │
├─────────────────────────────────────────────────────────────┤
│   HTTP请求拦截器  │  主题管理  │  工具函数  │  3D渲染引擎    │
└─────────────────────────────────────────────────────────────┘
```

### 前端核心模块

#### 1. 应用入口模块 (main.js)
**功能职责:**
- 应用初始化
- 插件注册 (Pinia, Vue Router, Element Plus)
- 全局组件注册
- 主题系统初始化

#### 2. 根组件模块 (App.vue)
**功能职责:**
- 应用布局管理
- 组件间通信协调
- 模型生成事件处理


#### 3. 顶部导航模块 (AppHeader.vue)
**功能职责:**
- 应用标题显示
- 主题切换控制
- 用户操作入口

#### 4. 左侧导航模块 (LeftNav.vue)
**功能职责:**
- 导航菜单管理
- 侧边栏折叠控制

#### 5. 中央工作区模块 (CenterWorkspace.vue)
**功能职责:**
- 3D 模型预览和渲染
- 模型操作工具栏
- 模型导出

**主要功能:**
- 3D 模型加载和显示
- 缩放控制 (放大/缩小/重置)
- 光照强度调节
- 网格显示切换
- 统计信息显示
- 模型导出下载
- 模型可见性控制

#### 6. 右侧控制面板模块 (RightColumn.vue)
**功能职责:**
- AI 模型生成控制
- 输入方式切换 (文字/图片)
- 生成参数配置
- 资产库管理

**主要功能:**
- 文字描述生成 3D 模型
- 图片上传生成 3D 模型
- 风格选择和参数配置
- 生成进度监控
- 历史模型浏览
- 模型预览和下载

#### 7. 3D 渲染模块 (ThreeScene.vue)
**功能职责:**
- Three.js 3D 场景管理
- 模型加载和渲染
- 交互控制 (旋转、缩放、平移)
- 光照和材质管理

**技术实现:**
- WebGL 渲染器
- 透视相机
- 轨道控制器 (OrbitControls)
- GLTF 模型加载器
- 环境光和方向光
- 网格辅助线
- 性能统计 (Stats)

### 前端数据管理

#### 状态管理 (Pinia)
**主题状态管理:**
- isDark: Boolean (暗黑模式状态)
- toggleTheme() (切换主题)
- applyTheme(dark) (应用主题)
- initTheme() (初始化主题)

#### 本地存储
- theme: 主题设置 ('dark' | 'light')

### 前端API接口层

#### HTTP 客户端配置 (utils/request.js)
**功能特性:**
- 统一的请求/响应拦截器
- 自动 Token 认证
- 错误处理机制
- 完整 URL 支持

#### 模型生成 API (api/modelGeneration.js)
**接口列表:**
- uploadImage(file) - 上传图片
- generateModelFromText(data) - 文字生成模型
- generateModelFromImage(data) - 图片生成模型
- getModelHistoryApi() - 获取模型历史
- getModelByIdApi(id) - 根据ID查询模型


### 前端性能优化

#### 代码分割
- 组件按需导入
- 第三方库分包

#### 资源优化
- 3D 模型压缩
- 静态资源缓存

#### 渲染优化
- Three.js 性能监控

### 前端开发规范

#### 代码规范
- ESLint + Prettier 统一代码风格
- Vue 3 Composition API 优先
- TypeScript 类型检查 (可选)

#### 组件规范
- 单文件组件 (SFC) 结构
- Props 类型定义
- 事件命名规范
- 样式作用域隔离

#### 浏览器兼容性
- 支持现代浏览器 (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
- 需要 WebGL 支持用于 3D 渲染
